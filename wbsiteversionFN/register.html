<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Login</title>

<style>
    body {
        margin: 0;
        font-family: "Inter", sans-serif;
        background: #ffffff;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
    }

    .container {
        width: 360px;
    }

    h1 {
        font-size: 28px;
        font-weight: 700;
        margin-bottom: 5px;
    }

    p.subtitle {
        color: #555;
        margin-bottom: 25px;
        font-size: 14px;
    }

    .role-switch {
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
    }

    .role-btn {
        width: 48%;
        padding: 10px;
        font-size: 14px;
        border-radius: 8px;
        border: 1px solid #ddd;
        cursor: pointer;
        background: #f7f7f7;
        transition: 0.2s;
    }

    .role-btn.active {
        background: black;
        color: white;
        border-color: black;
        font-weight: 600;
    }

    input {
        width: 100%;
        padding: 12px;
        margin: 10px 0;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 14px;
    }

    label {
        font-size: 14px;
        font-weight: 600;
        color: #333;
    }

    .options {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        margin-bottom: 15px;
    }

    button.signin-btn {
        width: 100%;
        padding: 12px;
        background: black;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 15px;
        cursor: pointer;
        font-weight: 600;
    }

    .footer {
        margin-top: 20px;
        text-align: center;
        font-size: 14px;
    }

    .footer a {
        color: black;
        font-weight: 600;
        text-decoration: none;
    }
</style>
</head>

<body>

<div class="container">

    <h1>Welcome back</h1>
    <p class="subtitle">Please enter your details</p>

    <!-- Authority / CSR Switch -->
    <div class="role-switch">
        <button id="authBtn" class="role-btn active">Authority</button>
        <button id="csrBtn" class="role-btn">CSR</button>
    </div>

    <!-- Email -->
    <label>Email address</label>
    <input type="email" id="email" placeholder="Enter your email" />

    <!-- Password -->
    <label>Password</label>
    <input type="password" id="password" placeholder="Enter password" />

    <!-- Authority Fields -->
    <div id="authorityFields">
        <label>Authority Code</label>
        <input type="text" id="authCode" placeholder="Enter your authority code" />

        <label>Area / Location</label>
        <input type="text" id="location" placeholder="Enter your area / location" />
    </div>

    <!-- CSR Fields -->
    <div id="csrFields" style="display:none;">
        <label>Company Name</label>
        <input type="text" id="companyName" placeholder="Enter company name" />

        <label>Company ID</label>
        <input type="text" id="companyId" placeholder="Enter company ID" />
    </div>

    <div class="options">
        <label><input type="checkbox"> Remember for 30 days</label>
        <a href="#" style="color:black; text-decoration:none;">Forgot password</a>
    </div>

    <button class="signin-btn" onclick="loginUser()">Sign in</button>

    <div class="footer">
        Don't have an account? <a href="register.html">Sign up</a>
    </div>

</div>

<script>
    /* =======================
          BACKEND BASE URL
       ======================= */
    const API_BASE = "http://localhost:5000/api";

    let role = "authority";

    const authorityFields = document.getElementById("authorityFields");
    const csrFields = document.getElementById("csrFields");

    /* =======================
        ROLE SWITCH BUTTONS
       ======================= */
    document.getElementById("authBtn").onclick = function () {
        role = "authority";
        this.classList.add("active");
        document.getElementById("csrBtn").classList.remove("active");

        authorityFields.style.display = "block";
        csrFields.style.display = "none";
    };

    document.getElementById("csrBtn").onclick = function () {
        role = "csr";
        this.classList.add("active");
        document.getElementById("authBtn").classList.remove("active");

        authorityFields.style.display = "none";
        csrFields.style.display = "block";
    };

    /* =======================
           LOGIN FUNCTION
       ======================= */
    async function loginUser() {
        const email = document.getElementById("email").value.trim();
        const pass = document.getElementById("password").value.trim();

        if (!email || !pass) {
            alert("Please fill all required fields.");
            return;
        }

        try {
            if (role === "authority") {
                const authCode = document.getElementById("authCode").value.trim();
                const location = document.getElementById("location").value.trim();

                if (!authCode || !location) {
                    alert("Authority: Please fill all fields.");
                    return;
                }

                const res = await fetch(`${API_BASE}/authority/login`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email, password: pass, authorityCode: authCode, location })
                });

                const data = await res.json();
                if (!res.ok) return alert(data.message || "Authority login failed");

                localStorage.setItem("authority_token", data.token);

                window.location.href = "authority_dashboard.html";
            } 
            else {
                const cname = document.getElementById("companyName").value.trim();
                const cid = document.getElementById("companyId").value.trim();

                if (!cname || !cid) {
                    alert("CSR: Please fill all fields.");
                    return;
                }

                const res = await fetch(`${API_BASE}/csr/login`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email, password: pass, companyName: cname, companyId: cid })
                });

                const data = await res.json();
                if (!res.ok) return alert(data.message || "CSR login failed");

                localStorage.setItem("csr_token", data.token);

                window.location.href = "csr_dashboard.html";
            }
        } catch (err) {
            console.error(err);
            alert("Something went wrong. Try again.");
        }
    }
</script>

</body>
</html>
